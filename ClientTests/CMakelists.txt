cmake_minimum_required(VERSION 3.14)

project(unit_tests)
set(CMAKE_CXX_STANDARD 11)

set(TESTS_BIN_PATH ${CMAKE_PROJECT_NAME}/testbins)
set(TESTS_BIN_NAME UnitTestProj)
SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)
set (GTEST_PATH ${CMAKE_SOURCE_DIR}/3rd/gtest)
message(STATUS "gtest path is ${GTEST_PATH}")

# include
include_directories(${COMMON_PATH}/
	${GTEST_PATH}/include
    )
	
# source files 
#file(GLOB TEST_ALL_FILE
#    # ${COMMON_PATH}/*.cpp
#	${CLIENT_TESTS_PATH}/src/*.cpp
#	)
	
# aux_source_directory(${CLIENT_TESTS_PATH}/src TEST_ALL_FILE)
file(GLOB_RECURSE TEST_ALL_FILE
  "${CLIENT_TESTS_PATH}/src/*.cpp"
)
message(STATUS "all file list is: ${TEST_ALL_FILE}")

file(GLOB_RECURSE NO_USE_FILES
  "${CLIENT_TESTS_PATH}/src/Test*.cpp"
)

message(STATUS "no use. file list is: ${NO_USE_FILES}")
list(REMOVE_ITEM ${TEST_ALL_FILE} ${NO_USE_FILES})
message(STATUS "1. file list is: ${TEST_ALL_FILE}")
list(REMOVE_ITEM ${TEST_ALL_FILE} "${CLIENT_TESTS_PATH}/src/TestMain.cpp")
message(STATUS "2. file list is: ${TEST_ALL_FILE}")
list(REMOVE_AT ${TEST_ALL_FILE} 1)
message(STATUS "3. file list is: ${TEST_ALL_FILE}")

link_directories(${GTEST_PATH}/lib)
add_executable(${TESTS_BIN_NAME} ${TEST_ALL_FILE})

# add_library(gtest SHARED IMPORTED)
# add_library(gtest_main SHARED IMPORTED)
# set_target_properties(gtest PROPERTIES IMPORTED_LOCATION ${GTEST_PATH}/lib/gtest.lib)
# set_target_properties(gtest_main PROPERTIES IMPORTED_LOCATION ${GTEST_PATH}/lib/gtest_main.lib)
target_link_libraries(${TESTS_BIN_NAME} gtest.lib)
target_link_libraries(${TESTS_BIN_NAME} gtest_main.lib)
